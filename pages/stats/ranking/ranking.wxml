<!-- pages/stats/ranking/ranking.wxml -->
<view class="page-container">
  <!-- Â§¥ÈÉ®ËÉåÊôØË£ÖÈ•∞ -->
  <view class="header-bg">
    <view class="bg-circle circle-1"></view>
    <view class="bg-circle circle-2"></view>
    <view class="bg-circle circle-3"></view>
  </view>

  <!-- TabÂàáÊç¢ -->
  <view class="tabs-wrapper">
    <view class="tabs">
      <view
        wx:for="{{rankTabs}}"
        wx:key="id"
        class="tab-item {{rankType === item.id ? 'active' : ''}}"
        bindtap="onTabChange"
        data-type="{{item.id}}">
        <view class="tab-icon">{{item.icon}}</view>
        <text class="tab-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- Á≠õÈÄâÂô® -->
  <view class="filter-container">
    <!-- ÈùûË∫´‰ª∑Ê¶úÔºöÊòæÁ§∫ËåÉÂõ¥ÂíåËµõÂ≠£Á≠õÈÄâ -->
    <block wx:if="{{rankType !== 'value'}}">
      <view class="filter-group">
        <view
          wx:for="{{scopeOptions}}"
          wx:key="id"
          class="filter-item {{scope === item.id ? 'active' : ''}}"
          bindtap="onScopeChange"
          data-scope="{{item.id}}">
          {{item.name}}
        </view>
      </view>
      <view class="season-picker">
        <picker
          mode="selector"
          range="{{seasonOptions}}"
          range-key="name"
          value="{{seasonIndex}}"
          bindchange="onSeasonChange">
          <view class="picker-text">
            {{seasonOptions[seasonIndex].name}}
            <text class="picker-arrow">‚ñº</text>
          </view>
        </picker>
      </view>
    </block>

    <!-- Ë∫´‰ª∑Ê¶úÔºöÊòæÁ§∫‰ø±‰πêÈÉ®Âπ¥Â∫¶Á≠õÈÄâ -->
    <block wx:else>
      <view class="filter-group">
        <view class="filter-item active">Âπ¥Â∫¶Ë∫´‰ª∑ÊéíË°å</view>
      </view>
      <view class="season-picker" wx:if="{{clubYearOptions.length > 0}}">
        <picker
          mode="selector"
          range="{{clubYearOptions}}"
          range-key="name"
          value="{{clubYearIndex}}"
          bindchange="onClubYearChange">
          <view class="picker-text">
            {{clubYearOptions[clubYearIndex].name}}
            <text class="picker-arrow">‚ñº</text>
          </view>
        </picker>
      </view>
    </block>
  </view>

  <!-- È¢ÜÂ•ñÂè∞Âå∫Âüü -->
  <view class="podium-container" wx:if="{{topThree.length > 0}}">
    <view class="podium-stage">
      <!-- Á¨¨‰∫åÂêç -->
      <view class="podium-item rank-2" wx:if="{{topThree[1]}}" bindtap="onPlayerTap" data-id="{{topThree[1].id}}">
        <view class="player-avatar-wrapper">
          <image class="player-avatar" src="{{topThree[1].avatar}}" mode="aspectFill"></image>
          <view class="avatar-glow glow-silver"></view>
        </view>
        <view class="player-name">{{topThree[1].name}}</view>
        <view class="player-team" wx:if="{{rankType !== 'value'}}" style="color: {{topThree[1].teamColor}}">{{topThree[1].team}}</view>
        <view class="player-value">
          <text class="value-number">{{topThree[1].value}}</text>
          <text class="value-unit" wx:if="{{rankType !== 'attendance'}}">{{getRankLabel()}}</text>
          <text class="value-unit" wx:else>%</text>
        </view>
        <view class="podium-base base-2">
          <view class="base-top"></view>
          <view class="base-rank">ü•à</view>
        </view>
      </view>

      <!-- Á¨¨‰∏ÄÂêç -->
      <view class="podium-item rank-1" wx:if="{{topThree[0]}}" bindtap="onPlayerTap" data-id="{{topThree[0].id}}">
        <view class="player-avatar-wrapper">
          <image class="player-avatar" src="{{topThree[0].avatar}}" mode="aspectFill"></image>
          <view class="avatar-glow glow-gold"></view>
        </view>
        <view class="player-name">{{topThree[0].name}}</view>
        <view class="player-team" wx:if="{{rankType !== 'value'}}" style="color: {{topThree[0].teamColor}}">{{topThree[0].team}}</view>
        <view class="player-value">
          <text class="value-number">{{topThree[0].value}}</text>
          <text class="value-unit" wx:if="{{rankType !== 'attendance'}}">{{getRankLabel()}}</text>
          <text class="value-unit" wx:else>%</text>
        </view>
        <view class="podium-base base-1">
          <view class="base-top"></view>
          <view class="base-rank">ü•á</view>
        </view>
      </view>

      <!-- Á¨¨‰∏âÂêç -->
      <view class="podium-item rank-3" wx:if="{{topThree[2]}}" bindtap="onPlayerTap" data-id="{{topThree[2].id}}">
        <view class="player-avatar-wrapper">
          <image class="player-avatar" src="{{topThree[2].avatar}}" mode="aspectFill"></image>
          <view class="avatar-glow glow-bronze"></view>
        </view>
        <view class="player-name">{{topThree[2].name}}</view>
        <view class="player-team" wx:if="{{rankType !== 'value'}}" style="color: {{topThree[2].teamColor}}">{{topThree[2].team}}</view>
        <view class="player-value">
          <text class="value-number">{{topThree[2].value}}</text>
          <text class="value-unit" wx:if="{{rankType !== 'attendance'}}">{{getRankLabel()}}</text>
          <text class="value-unit" wx:else>%</text>
        </view>
        <view class="podium-base base-3">
          <view class="base-top"></view>
          <view class="base-rank">ü•â</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ÂÆåÊï¥ÊéíË°åÊ¶úÂàóË°® -->
  <view class="ranking-section">
    <view class="section-header">
      <view class="header-line"></view>
      <text class="header-text">ÂÆåÊï¥ÊéíÂêç</text>
      <view class="header-line"></view>
    </view>

    <view class="ranking-list" wx:if="{{remainingList.length > 0}}">
      <view
        wx:for="{{remainingList}}"
        wx:key="id"
        class="ranking-item {{item.isCurrentUser ? 'highlight' : ''}}"
        bindtap="onPlayerTap"
        data-id="{{item.id}}">
        <!-- ÊéíÂêç -->
        <view class="rank-number">
          <text class="rank-text">{{item.rank}}</text>
        </view>

        <!-- ÁêÉÂëò‰ø°ÊÅØ -->
        <image class="player-avatar-small" src="{{item.avatar}}" mode="aspectFill"></image>
        <view class="player-info">
          <view class="player-name-row">
            <text class="name">{{item.name}}</text>
            <view class="current-tag" wx:if="{{item.isCurrentUser}}">Êàë</view>
          </view>
          <view class="meta" wx:if="{{rankType !== 'value'}}">
            <text class="team" style="color: {{item.teamColor}}">{{item.team}}</text>
            <text class="matches">{{item.matches}}Âú∫</text>
          </view>
        </view>

        <!-- Êï∞ÊçÆÂÄº -->
        <view class="value-container">
          <text class="value">{{item.value}}<text class="unit" wx:if="{{rankType === 'attendance'}}">%</text></text>
          <text class="label">{{getRankLabel()}}</text>
        </view>
      </view>
    </view>

    <!-- Á©∫Áä∂ÊÄÅ -->
    <view class="empty-state" wx:if="{{!loading && rankingList.length === 0}}">
      <text class="empty-icon">üìä</text>
      <text class="empty-text">ÊöÇÊó†ÊéíÂêçÊï∞ÊçÆ</text>
    </view>
  </view>

  <!-- Â∫ïÈÉ®Âç†‰Ωç -->
  <view class="bottom-space"></view>
</view>
