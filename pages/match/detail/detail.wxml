<!-- æ¯”èµ›è¯¦æƒ…é¡µé¢ - é‡æ–°è®¾è®¡ -->
<view class="detail-container">
  <!-- é¡¶éƒ¨æ¸å˜èƒŒæ™¯ -->
  <view class="top-gradient"></view>

  <scroll-view class="content" scroll-y enable-back-to-top>
    <!-- æ¯”èµ›ä¿¡æ¯å¡ç‰‡ -->
    <view class="match-hero-card" data-status="{{matchInfo.status}}">
      <!-- å¯¹é˜µä¿¡æ¯ -->
      <view class="match-vs">
        <view class="team-section">
          <view class="team-logo-wrapper">
            <image class="team-logo-large" src="{{matchInfo.team1.logo}}" mode="aspectFit"></image>
          </view>
          <text class="team-name-hero">{{matchInfo.team1.name}}</text>
          <!-- å·²ç»“æŸ/è¿›è¡Œä¸­ï¼šæ˜¾ç¤ºæ¯”åˆ† -->
          <view class="team-score-badge" wx:if="{{matchInfo.status === 'finished' || matchInfo.status === 'ongoing'}}">
            <text class="score-number">{{matchInfo.team1FinalScore !== undefined ? matchInfo.team1FinalScore : (matchInfo.team1Score || 0)}}</text>
            <text class="goal-number" wx:if="{{matchInfo.team1TotalGoals !== undefined}}">({{matchInfo.team1TotalGoals}}çƒ)</text>
          </view>
        </view>

        <view class="vs-section">
          <text class="vs-text">VS</text>
          <view class="match-status status-{{matchInfo.status}}">
            {{matchInfo.status === 'upcoming' ? 'æœªå¼€å§‹' : matchInfo.status === 'ongoing' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}
          </view>
        </view>

        <view class="team-section">
          <view class="team-logo-wrapper">
            <image class="team-logo-large" src="{{matchInfo.team2.logo}}" mode="aspectFit"></image>
          </view>
          <text class="team-name-hero">{{matchInfo.team2.name}}</text>
          <!-- å·²ç»“æŸ/è¿›è¡Œä¸­ï¼šæ˜¾ç¤ºæ¯”åˆ† -->
          <view class="team-score-badge" wx:if="{{matchInfo.status === 'finished' || matchInfo.status === 'ongoing'}}">
            <text class="score-number">{{matchInfo.team2FinalScore !== undefined ? matchInfo.team2FinalScore : (matchInfo.team2Score || 0)}}</text>
            <text class="goal-number" wx:if="{{matchInfo.team2TotalGoals !== undefined}}">({{matchInfo.team2TotalGoals}}çƒ)</text>
          </view>
        </view>
      </view>

      <!-- æ¯”èµ›æ ‡é¢˜ -->
      <view class="match-title-hero">{{matchInfo.title}}</view>

      <!-- ç‚¹çƒå¤§æˆ˜æ¯”åˆ† -->
      <view class="penalty-shootout-detail" wx:if="{{matchInfo.penaltyShootout.enabled}}">
        <view class="penalty-detail-label">ç‚¹çƒå¤§æˆ˜</view>
        <view class="penalty-detail-score">
          <view class="penalty-detail-team {{matchInfo.penaltyShootout.winner === 'team1' ? 'winner' : ''}}">
            {{matchInfo.penaltyShootout.team1Score}}
          </view>
          <view class="penalty-detail-separator">-</view>
          <view class="penalty-detail-team {{matchInfo.penaltyShootout.winner === 'team2' ? 'winner' : ''}}">
            {{matchInfo.penaltyShootout.team2Score}}
          </view>
        </view>
        <view class="penalty-winner-text">
          ğŸ† {{matchInfo.penaltyShootout.winner === 'team1' ? matchInfo.team1.name : matchInfo.team2.name}} ç‚¹çƒè·èƒœ
        </view>
      </view>

      <!-- åŸºæœ¬ä¿¡æ¯ -->
      <view class="match-info-row">
        <text class="info-text">{{matchInfo.dateMonth}}{{matchInfo.dateDay}}æ—¥ {{matchInfo.time}}</text>
        <text class="info-divider">Â·</text>
        <text class="info-text">{{matchInfo.location}}</text>
        <text class="info-divider">Â·</text>
        <text class="info-text">{{matchInfo.maxPlayersPerTeam || 11}}äººåˆ¶</text>
      </view>
    </view>

    <!-- æ¯”èµ›æ•°æ®ï¼ˆè¿›è¡Œä¸­/å·²å®Œæˆçš„æ¯”èµ›ï¼‰ -->
    <view class="match-data-section" wx:if="{{(matchInfo.status === 'ongoing' || matchInfo.status === 'finished') && matchInfo.quarterEvents && matchInfo.quarterEvents.length > 0}}">
      <!-- <view class="section-header">
        <text class="section-title">æ¯”èµ›æ•°æ®</text>
      </view> -->

      <!-- èŠ‚æ¬¡Tabåˆ‡æ¢ -->
      <view class="quarter-tabs">
        <view class="quarter-tab {{currentQuarter === item.quarterNumber ? 'active' : ''}}" wx:for="{{matchInfo.quarterEvents}}" wx:key="quarterNumber" bindtap="onSwitchQuarter" data-quarter="{{item.quarterNumber}}">
          <text class="tab-label">{{item.quarterLabel}}</text>
        </view>
      </view>

      <!-- å½“å‰èŠ‚æ¬¡çš„æ¯”èµ›æ•°æ® -->
      <view class="quarter-content" wx:for="{{matchInfo.quarterEvents}}" wx:key="quarterNumber" wx:if="{{currentQuarter === item.quarterNumber}}">
        <!-- è¯¥èŠ‚æ¬¡çš„äº‹ä»¶æ—¶é—´è½´ -->
        <view class="timeline-wrapper" wx:if="{{item.events.length > 0}}">
          <!-- é˜Ÿä¼åç§° -->
          <view class="quarter-teams-header">
            <text class="team-name-left">{{matchInfo.team1.name}}</text>
            <text class="score-display">{{item.team1Score}} : {{item.team2Score}}</text>
            <text class="team-name-right">{{matchInfo.team2.name}}</text>
          </view>

          <event-timeline events="{{item.events}}" team1="{{matchInfo.team1}}" team2="{{matchInfo.team2}}" showActions="{{false}}">
          </event-timeline>
        </view>

        <!-- æ— äº‹ä»¶æç¤º -->
        <view class="empty-events" wx:else>
          <text class="empty-icon">ğŸ“‹</text>
          <text class="empty-text">æœ¬èŠ‚æš‚æ— æ•°æ®</text>
        </view>
      </view>

      <!-- MVPï¼ˆå·²å®Œæˆçš„æ¯”èµ›ï¼‰ -->
      <view class="mvp-card" wx:if="{{matchInfo.status === 'finished' && matchInfo.result && matchInfo.result.mvp}}">
        <view class="mvp-icon">ğŸ†</view>
        <view class="mvp-info">
          <text class="mvp-label">æœ¬åœºMVP</text>
          <text class="mvp-name">{{matchInfo.result.mvp.name}}</text>
        </view>
        <image class="mvp-avatar" src="{{matchInfo.result.mvp.avatar}}" mode="aspectFill"></image>
      </view>

      <!-- æ¯”èµ›ç®€æŠ¥ï¼ˆå·²å®Œæˆçš„æ¯”èµ›ä¸”æœ‰ç®€æŠ¥å†…å®¹ï¼‰ -->
      <view class="summary-card" wx:if="{{matchInfo.status === 'finished' && matchInfo.result && matchInfo.result.summary}}">
        <view class="summary-header">
          <text class="summary-title">ğŸ“ æ¯”èµ›ç®€æŠ¥</text>
        </view>
        <view class="summary-content">
          <text class="summary-text">{{matchInfo.result.summary}}</text>
        </view>
      </view>

      <!-- æ¯”èµ›ç…§ç‰‡ï¼ˆå·²å®Œæˆçš„æ¯”èµ›ä¸”æœ‰ç…§ç‰‡ï¼‰ -->
      <view class="photos-card" wx:if="{{matchInfo.status === 'finished' && matchInfo.result && matchInfo.result.photos && matchInfo.result.photos.length > 0}}">
        <view class="photos-header">
          <text class="photos-title">ğŸ“· æ¯”èµ›ç…§ç‰‡</text>
          <text class="photos-count">{{matchInfo.result.photos.length}}å¼ </text>
        </view>
        <view class="photos-grid">
          <image
            class="photo-item"
            wx:for="{{matchInfo.result.photos}}"
            wx:key="index"
            src="{{item}}"
            mode="aspectFill"
            bindtap="onPreviewPhoto"
            data-index="{{index}}">
          </image>
        </view>
      </view>
    </view>

    <!-- æŠ¥åæƒ…å†µ/åˆ°åœºæƒ…å†µï¼ˆæ‰€æœ‰çŠ¶æ€éƒ½æ˜¾ç¤ºï¼‰ -->
    <view class="registration-section">
      <view class="section-header">
        <text class="section-title">{{matchInfo.status === 'finished' ? 'åˆ°åœºæƒ…å†µ' : 'æŠ¥åæƒ…å†µ'}}</text>
        <text class="section-subtitle">å…±{{matchInfo.status === 'finished' ? totalAttendedCount : (team1Players.length + team2Players.length)}}äºº{{matchInfo.status === 'finished' ? 'åˆ°åœº' : 'æŠ¥å'}}</text>
      </view>

      <view class="teams-tabs">
        <view class="team-tab {{currentTeam === 'team1' ? 'active' : ''}}" bindtap="onSwitchTeam" data-team="team1">
          <text class="tab-name">{{matchInfo.team1.name}}</text>
          <view class="tab-count">{{matchInfo.status === 'finished' ? team1AttendedCount : team1Players.length}}</view>
        </view>
        <view class="team-tab {{currentTeam === 'team2' ? 'active' : ''}}" bindtap="onSwitchTeam" data-team="team2">
          <text class="tab-name">{{matchInfo.team2.name}}</text>
          <view class="tab-count">{{matchInfo.status === 'finished' ? team2AttendedCount : team2Players.length}}</view>
        </view>
      </view>

      <!-- çƒå‘˜åˆ—è¡¨å®¹å™¨ï¼ˆå¯èƒ½è¢«é®ç½©ï¼‰ -->
      <view class="players-wrapper {{isOpponentTeam ? 'opponent-team' : ''}}">
        <view class="players-grid" wx:if="{{currentPlayers.length > 0}}">
          <view class="player-card-mini {{!item.isAttended ? 'absent' : ''}} {{item.isMvp ? 'mvp-player' : ''}}" wx:for="{{currentPlayers}}" wx:key="id">
            <view class="avatar-wrapper">
              <image class="player-avatar-mini" src="{{item.avatar || images.defaultAvatar}}" mode="aspectFill"></image>
              <!-- çƒè¡£å·ç å¾½ç« ï¼ˆä»…æ­£å¼é˜Ÿå‘˜æ˜¾ç¤ºï¼‰ -->
              <view class="jersey-badge" wx:if="{{item.jerseyNumber && item.memberType === 'regular'}}">{{item.jerseyNumber}}</view>
              <!-- ç¼ºå¸­æ ‡è®°ï¼ˆä»…å·²å®Œæˆçš„æ¯”èµ›æ˜¾ç¤ºï¼‰ -->
              <view class="absent-badge" wx:if="{{matchInfo.status === 'finished' && !item.isAttended}}">ç¼ºå¸­</view>
              <!-- ä¸´æ—¶å‚åŠ æ ‡è®°ï¼ˆä»…å·²å®Œæˆçš„æ¯”èµ›ä¸”ä¸ºä¸´æ—¶å‚åŠ çƒå‘˜æ˜¾ç¤ºï¼‰ -->
              <view class="walkin-badge" wx:if="{{matchInfo.status === 'finished' && item.isWalkIn}}">ä¸´æ—¶</view>
              <!-- MVPæ ‡è®°ï¼ˆä»…å·²å®Œæˆçš„æ¯”èµ›æ˜¾ç¤ºï¼‰ -->
              <view class="mvp-badge-mini" wx:if="{{matchInfo.status === 'finished' && item.isMvp}}">ğŸ†</view>
            </view>
            <text class="player-name-mini">{{item.realName || item.nickname}}</text>
          </view>
        </view>

        <view class="empty-state" wx:else>
          <text class="empty-icon">ğŸ‘¥</text>
          <text class="empty-text">æš‚æ— äººæŠ¥å</text>
        </view>

        <!-- è¯·å‡äººå‘˜åˆ—è¡¨ -->
        <view class="leave-list-detail" wx:if="{{(currentTeam === 'team1' && team1LeavePlayers.length > 0) || (currentTeam === 'team2' && team2LeavePlayers.length > 0)}}">
          <view class="leave-players-grid">
            <view class="player-card-mini leave-player" wx:for="{{currentTeam === 'team1' ? team1LeavePlayers : team2LeavePlayers}}" wx:key="id">
              <view class="avatar-wrapper">
                <image class="player-avatar-mini" src="{{item.avatar || images.defaultAvatar}}" mode="aspectFill"></image>
                <!-- è¯·å‡æ ‡è®° -->
                <view class="leave-badge-detail">å‡</view>
              </view>
              <text class="player-name-mini">{{item.realName || item.nickname}}</text>
            </view>
          </view>
        </view>

        <!-- å¯¹æ‰‹é˜µå®¹é®ç½©ï¼ˆä»…æœªå¼€å§‹çš„æ¯”èµ›ä¸”æŸ¥çœ‹å¯¹æ‰‹é˜Ÿä¼æ—¶æ˜¾ç¤ºï¼‰ -->
        <view class="opponent-mask-detail" wx:if="{{isOpponentTeam && matchInfo.status === 'upcoming'}}">
          <view class="mask-content">
            <view class="lock-icon">â›”</view>
            <text class="mask-title">ç»å¯†å†›æƒ…</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¯”èµ›è¯´æ˜ -->
    <view class="description-section" wx:if="{{matchInfo.description}}">
      <view class="section-header">
        <text class="section-title">æ¯”èµ›è¯´æ˜</text>
      </view>
      <view class="description-content">
        <text class="description-text">{{matchInfo.description}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-space"></view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ ï¼ˆæœªå¼€å§‹çš„æ¯”èµ›ï¼‰ -->
  <view class="action-bar" wx:if="{{matchInfo.status === 'upcoming'}}">
    <button class="action-btn share-btn" open-type="share">
      <text class="btn-text">åˆ†äº«</text>
      <text class="btn-icon">ğŸ“¤</text>
    </button>
    <!-- å»æŠ¥åæŒ‰é’®ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è§ï¼‰ -->
    <view class="action-btn register-btn" bindtap="onGoToRegister">
      <text class="btn-text">å»æŠ¥å</text>
      <text class="btn-icon">âš¡</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ ï¼ˆå·²ç»“æŸçš„æ¯”èµ› - ä»…è¶…çº§ç®¡ç†å‘˜å¯è§ï¼‰ -->
  <view class="action-bar" wx:if="{{matchInfo.status === 'finished' && !matchInfo.hasRecord && canRecordMatch}}">
    <view class="action-btn record-btn" bindtap="onManualRecord">
      <text class="btn-text">å½•å…¥æ¯”èµ›è®°å½•</text>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ ï¼ˆè¿›è¡Œä¸­çš„æ¯”èµ› - æ‰€æœ‰ç”¨æˆ·å¯è§ï¼‰ -->
  <view class="action-bar" wx:if="{{matchInfo.status === 'ongoing'}}">
    <view class="action-btn record-btn" bindtap="onManualRecord">
      <text class="btn-text">å½•å…¥æ¯”èµ›è®°å½•</text>
    </view>
  </view>
</view>