<!-- AIç®€æŠ¥å½•å…¥é¡µé¢ -->
<view class="report-import-container">

  <!-- æ­¥éª¤1: è¾“å…¥ç®€æŠ¥ -->
  <view class="step-content" wx:if="{{currentStep === 1}}">
    <!-- é¡µé¢æ ‡é¢˜ -->
    <view class="page-header">
      <text class="page-title">AIæ™ºèƒ½ç®€æŠ¥å½•å…¥</text>
      <text class="page-desc">ç²˜è´´æ¯”èµ›ç®€æŠ¥æ–‡æœ¬ï¼ŒAIè‡ªåŠ¨è¯†åˆ«å¹¶æå–ç»“æ„åŒ–æ•°æ®</text>
    </view>

    <!-- åŠŸèƒ½ç‰¹ç‚¹ -->
    <view class="features">
      <view class="feature-item">
        <text class="feature-icon">ğŸ¤–</text>
        <text class="feature-text">AIæ™ºèƒ½è§£æ</text>
      </view>
      <view class="feature-item">
        <text class="feature-icon">ğŸ“</text>
        <text class="feature-text">æ”¯æŒä»»æ„æ ¼å¼</text>
      </view>
      <view class="feature-item">
        <text class="feature-icon">âš¡</text>
        <text class="feature-text">å¿«é€Ÿå½•å…¥</text>
      </view>
      <view class="feature-item">
        <text class="feature-icon">âœ“</text>
        <text class="feature-text">å‡†ç¡®ç‡95%+</text>
      </view>
    </view>

    <!-- ç®€æŠ¥è¾“å…¥æ¡† -->
    <view class="input-section">
      <view class="input-header">
        <text class="input-title">æ¯”èµ›ç®€æŠ¥</text>
        <view class="input-actions">
          <text class="action-link" bindtap="onUseExample">ä½¿ç”¨ç¤ºä¾‹</text>
          <text class="action-divider">|</text>
          <text class="action-link" bindtap="onClearText">æ¸…ç©º</text>
        </view>
      </view>

      <textarea
        class="report-textarea"
        placeholder="è¯·ç²˜è´´æ¯”èµ›ç®€æŠ¥æ–‡æœ¬...&#10;&#10;ç¤ºä¾‹æ ¼å¼ï¼š&#10;å˜‰é™µæ‘©æ‰˜ï¼ˆçº¢ï¼‰VS é•¿æ±Ÿï¼ˆèŠ±ï¼‰&#10;æ˜ŸæœŸå…­2025.10.12ï¼Œè½¨é“é›†å›¢&#10;æ¯”åˆ†:3:0&#10;&#10;åˆ°åœºäººå‘˜ï¼š&#10;çº¢ï¼šé»„æ³¢ æ–½æ¯… æ´ªèƒœ..."
        value="{{reportText}}"
        bindinput="onReportInput"
        auto-height
        maxlength="-1"
      />

      <view class="input-footer">
        <text class="char-count">{{reportText.length}} å­—ç¬¦</text>
      </view>
    </view>

    <!-- æ¸©é¦¨æç¤º -->
    <view class="tips-section">
      <view class="tips-header">
        <text class="tips-icon">ğŸ’¡</text>
        <text class="tips-title">æ¸©é¦¨æç¤º</text>
      </view>
      <view class="tips-list">
        <text class="tip-item">â€¢ æ”¯æŒä»»æ„æ ¼å¼çš„ç®€æŠ¥æ–‡æœ¬</text>
        <text class="tip-item">â€¢ è‡ªåŠ¨è¯†åˆ«é˜Ÿä¼ã€æ—¥æœŸã€åœ°ç‚¹ã€æ¯”åˆ†</text>
        <text class="tip-item">â€¢ è‡ªåŠ¨æå–èŠ‚æ¬¡è¯¦æƒ…å’Œçƒå‘˜æ•°æ®</text>
        <text class="tip-item">â€¢ è§£æå®Œæˆåå¯é¢„è§ˆå’Œä¿®æ­£</text>
      </view>
    </view>

    <!-- è§£æè¿›åº¦ï¼ˆè§£æä¸­æ˜¾ç¤ºï¼‰ -->
    <view class="parse-progress" wx:if="{{isParsing}}">
      <view class="progress-header">
        <text class="progress-title">{{parseMessage}}</text>
        <text class="progress-percent">{{parseProgress}}%</text>
      </view>
      <view class="progress-bar-container">
        <view class="progress-bar" style="width: {{parseProgress}}%"></view>
      </view>
      <view class="progress-tips">
        <text class="tips-text">AIæ­£åœ¨åˆ†æç®€æŠ¥å†…å®¹ï¼Œè¯·ç¨å€™...</text>
      </view>
    </view>

    <!-- è§£ææŒ‰é’® -->
    <view class="bottom-actions">
      <button
        class="btn-parse"
        bindtap="onParseReport"
        loading="{{isParsing}}"
        disabled="{{isParsing || !reportText}}"
      >
        {{isParsing ? 'AIæ™ºèƒ½è§£æä¸­...' : 'å¼€å§‹è§£æ'}}
      </button>
    </view>
  </view>

  <!-- æ­¥éª¤2: è§£æç»“æœé¢„è§ˆ -->
  <view class="step-content" wx:if="{{currentStep === 2 && parsed}}">
    <!-- è§£ææ–¹å¼æ ‡è¯† -->
    <view class="parse-badge {{parseMethod === 'AI' ? 'ai-badge' : 'regex-badge'}}">
      <text class="badge-icon">{{parseMethod === 'AI' ? 'ğŸ¤–' : 'âš™ï¸'}}</text>
      <text class="badge-text">{{parseMethod === 'AI' ? 'AIæ™ºèƒ½è§£æ' : 'æ­£åˆ™è§£æ'}}</text>
      <text class="badge-confidence">{{parsed.confidence === 'high' ? 'é«˜å‡†ç¡®ç‡' : 'ä¸­ç­‰å‡†ç¡®ç‡'}}</text>
    </view>

    <!-- è­¦å‘Šä¿¡æ¯ -->
    <view class="warnings-section" wx:if="{{warnings.length > 0}}">
      <view class="warning-item" wx:for="{{warnings}}" wx:key="index">
        <text class="warning-icon">âš ï¸</text>
        <text class="warning-text">{{item}}</text>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="preview-card">
      <view class="card-header">
        <text class="card-title">åŸºæœ¬ä¿¡æ¯</text>
        <text class="card-icon">âœ“</text>
      </view>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">é˜Ÿä¼1</text>
          <text class="info-value">{{parsed.basicInfo.team1Name}} ({{parsed.basicInfo.team1Alias}})</text>
        </view>
        <view class="info-item">
          <text class="info-label">é˜Ÿä¼2</text>
          <text class="info-value">{{parsed.basicInfo.team2Name}} ({{parsed.basicInfo.team2Alias}})</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ¯”èµ›æ—¥æœŸ</text>
          <text class="info-value">{{parsed.basicInfo.date}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ¯”èµ›åœ°ç‚¹</text>
          <text class="info-value">{{parsed.basicInfo.location}}</text>
        </view>
        <view class="info-item full-width">
          <text class="info-label">æœ€ç»ˆæ¯”åˆ†</text>
          <text class="info-value highlight">{{parsed.basicInfo.finalScore}}</text>
        </view>
      </view>
    </view>

    <!-- èŠ‚æ¬¡æ•°æ® -->
    <view class="preview-card">
      <view class="card-header">
        <text class="card-title">èŠ‚æ¬¡æ•°æ®</text>
        <text class="card-badge">å…±{{parsed.quarters.length}}èŠ‚</text>
      </view>
      <view class="quarters-list">
        <view class="quarter-item" wx:for="{{parsed.quarters}}" wx:key="quarterNumber">
          <view class="quarter-header">
            <text class="quarter-title">ç¬¬{{item.quarterNumber}}èŠ‚</text>
            <text class="quarter-score">{{item.team1Goals}}:{{item.team2Goals}}</text>
          </view>
          <text class="quarter-summary">{{item.summary || 'æš‚æ— æ€»ç»“'}}</text>
        </view>
      </view>
    </view>

    <!-- åˆ°åœºäººå‘˜ -->
    <view class="preview-card">
      <view class="card-header">
        <text class="card-title">åˆ°åœºäººå‘˜</text>
      </view>
      <view class="participants-grid">
        <view class="participants-team">
          <text class="team-label">{{parsed.basicInfo.team1Alias}}é˜Ÿ</text>
          <view class="players-tags">
            <text class="player-tag" wx:for="{{parsed.participants.team1}}" wx:key="index">{{item}}</text>
          </view>
        </view>
        <view class="participants-team">
          <text class="team-label">{{parsed.basicInfo.team2Alias}}é˜Ÿ</text>
          <view class="players-tags">
            <text class="player-tag" wx:for="{{parsed.participants.team2}}" wx:key="index">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- çƒå‘˜æ•°æ®ç»Ÿè®¡ -->
    <view class="preview-card" wx:if="{{parsed.statistics}}">
      <view class="card-header">
        <text class="card-title">çƒå‘˜æ•°æ®</text>
      </view>
      <view class="stats-list">
        <view class="stat-item" wx:for="{{parsed.statistics}}" wx:for-item="stat" wx:for-index="playerName" wx:key="playerName">
          <text class="stat-player">{{playerName}}</text>
          <view class="stat-details">
            <text class="stat-value" wx:if="{{stat.goals > 0}}">{{stat.goals}}çƒ</text>
            <text class="stat-value" wx:if="{{stat.assists > 0}}">{{stat.assists}}åŠ©</text>
            <text class="stat-value" wx:if="{{stat.saves > 0}}">{{stat.saves}}é—¨</text>
            <text class="stat-value" wx:if="{{stat.referee > 0}}">{{stat.referee}}è£</text>
          </view>
        </view>
      </view>
    </view>

    <!-- MVP -->
    <view class="preview-card" wx:if="{{parsed.mvp && parsed.mvp.length > 0}}">
      <view class="card-header">
        <text class="card-title">MVP</text>
        <text class="mvp-icon">ğŸ†</text>
      </view>
      <view class="mvp-list">
        <text class="mvp-name" wx:for="{{parsed.mvp}}" wx:key="index">{{item}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="bottom-actions two-buttons">
      <button class="btn-secondary" bindtap="onBackToEdit">è¿”å›ä¿®æ”¹</button>
      <button
        class="btn-primary"
        bindtap="onConfirmImport"
        loading="{{isSubmitting}}"
        disabled="{{isSubmitting}}"
      >
        {{isSubmitting ? 'åˆ›å»ºä¸­...' : 'ç¡®è®¤å¯¼å…¥'}}
      </button>
    </view>
  </view>

</view>
