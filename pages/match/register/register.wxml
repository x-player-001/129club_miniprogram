<!-- æ¯”èµ›æŠ¥åé¡µé¢ -->
<view class="register-container">
  <!-- é¡¶éƒ¨æ¸å˜èƒŒæ™¯ -->
  <view class="top-gradient"></view>

  <scroll-view class="content" scroll-y enable-back-to-top>
    <!-- æ¯”èµ›å¤´éƒ¨å¡ç‰‡ -->
    <view class="hero-card">
      <!-- èƒŒæ™¯è£…é¥° -->
      <view class="hero-bg">
        <view class="circle-1"></view>
        <view class="circle-2"></view>
        <view class="circle-3"></view>
      </view>

      <!-- æ‹›å‹Ÿæ ‡è¯­ -->
      <view class="recruiting-banner">
        <view class="banner-icon pulse">âš½</view>
        <view class="banner-content">
          <text class="banner-title">é˜Ÿå‘˜æ‹›å‹Ÿä¸­</text>
          <text class="banner-subtitle">ä¸ºè£èª‰è€Œæˆ˜</text>
        </view>
        <view class="banner-badge shake">HOT</view>
      </view>

      <!-- å¯¹é˜µä¿¡æ¯ -->
      <view class="match-vs-hero">
        <view class="team-section" bindtap="onSwitchTeam" data-team="team1">
          <view class="team-logo-wrapper float {{currentTeamView === 'team1' ? 'active-team' : ''}}">
            <image class="team-logo-large" src="{{matchInfo.team1.logo}}" mode="aspectFit"></image>
            <view class="logo-glow" style="background: radial-gradient(circle, {{matchInfo.team1.color}}40 0%, transparent 70%);"></view>
          </view>
          <text class="team-name-hero">{{matchInfo.team1.name}}</text>
          <view class="team-count-badge">
            <text class="count-number">{{matchInfo.team1RegisteredCount || 0}}</text>
            <text class="count-label">äººå·²é›†ç»“</text>
          </view>
        </view>

        <view class="vs-section">
          <text class="vs-text-hero">VS</text>
          <view class="vs-line"></view>
        </view>

        <view class="team-section" bindtap="onSwitchTeam" data-team="team2">
          <view class="team-logo-wrapper float float-delay {{currentTeamView === 'team2' ? 'active-team' : ''}}">
            <image class="team-logo-large" src="{{matchInfo.team2.logo}}" mode="aspectFit"></image>
            <view class="logo-glow" style="background: radial-gradient(circle, {{matchInfo.team2.color}}40 0%, transparent 70%);"></view>
          </view>
          <text class="team-name-hero">{{matchInfo.team2.name}}</text>
          <view class="team-count-badge">
            <text class="count-number">{{matchInfo.team2RegisteredCount || 0}}</text>
            <text class="count-label">äººå·²é›†ç»“</text>
          </view>
        </view>
      </view>

      <!-- æ¯”èµ›æ ‡é¢˜ -->
      <view class="match-title-hero">{{matchInfo.title}}</view>

      <!-- å…³é”®ä¿¡æ¯ - å•è¡Œå±•ç¤º -->
      <view class="match-info-row">
        <text class="info-item-text">{{matchInfo.dateMonth}}{{matchInfo.dateDay}}æ—¥ {{matchInfo.time}}</text>
        <text class="info-divider">Â·</text>
        <text class="info-item-text">{{matchInfo.location}}</text>
        <text class="info-divider">Â·</text>
        <text class="info-item-text">{{matchInfo.maxPlayersPerTeam || 11}}äººåˆ¶</text>
      </view>
    </view>

    <!-- å·²æŠ¥åäººå‘˜åˆ—è¡¨ -->
    <view class="roster-section">
      <view class="roster-header">
        <text class="roster-title">å‡ºæˆ˜é˜µå®¹ - {{currentTeamView === 'team1' ? matchInfo.team1.name : matchInfo.team2.name}}</text>
      </view>

      <!-- é˜µå®¹å®¹å™¨ï¼ˆå¯èƒ½è¢«é®ç½©ï¼‰ -->
      <view class="roster-wrapper {{isOpponentTeam ? 'opponent-team' : ''}}">
        <view class="registered-grid" wx:if="{{registeredPlayers.length > 0}}">
          <view class="player-card fade-in-up" wx:for="{{registeredPlayers}}" wx:key="id" style="animation-delay: {{index * 0.05}}s;">
            <view class="player-avatar-wrapper">
              <image class="player-avatar-new" src="{{item.avatar || images.defaultAvatar}}" mode="aspectFill"></image>
              <view class="avatar-ring"></view>
              <!-- çƒè¡£å·ç ï¼ˆä»…æ­£å¼é˜Ÿå‘˜æ˜¾ç¤ºï¼‰ -->
              <text class="player-jersey" wx:if="{{item.jerseyNumber && item.memberType === 'regular'}}">{{item.jerseyNumber}}</text>
            </view>
            <view class="player-details">
              <text class="player-name-new">{{item.realName || item.nickname}}</text>
              <view class="player-tags">
                <position-tag wx:if="{{item.position}}" code="{{item.position}}" size="small"></position-tag>
              </view>
              <text class="player-nickname-new" wx:if="{{item.realName && item.nickname}}">@{{item.nickname}}</text>
              <!-- å¤‡æ³¨ä¿¡æ¯ -->
              <view class="player-notes" wx:if="{{item.notes}}">
                <text class="notes-icon">ğŸ’¬</text>
                <text class="notes-text">{{item.notes}}</text>
              </view>
            </view>
          </view>
        </view>

        <view class="empty-roster" wx:else>
          <view class="empty-icon">ğŸ‘¥</view>
          <text class="empty-title">è¿˜æ²¡æœ‰é˜Ÿå‘˜æŠ¥å</text>
          <text class="empty-subtitle">æˆä¸ºç¬¬ä¸€ä¸ªæŠ¥åçš„é˜Ÿå‘˜å§ï¼</text>
        </view>

        <!-- è¯·å‡äººå‘˜åˆ—è¡¨ -->
        <view class="leave-list" wx:if="{{(currentTeamView === 'team1' && team1LeavePlayers.length > 0) || (currentTeamView === 'team2' && team2LeavePlayers.length > 0)}}">
          <view class="leave-list-header">
            <text class="leave-list-title">è¯·å‡äººå‘˜ ({{currentTeamView === 'team1' ? team1LeavePlayers.length : team2LeavePlayers.length}})</text>
          </view>
          <view class="leave-grid">
            <view class="leave-card" wx:for="{{currentTeamView === 'team1' ? team1LeavePlayers : team2LeavePlayers}}" wx:key="id">
              <view class="leave-player-info">
                <image class="leave-avatar" src="{{item.avatar || images.defaultAvatar}}" mode="aspectFill"></image>
                <view class="leave-details">
                  <text class="leave-name">{{item.realName || item.nickname}}</text>
                  <text class="leave-reason">{{item.reason}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>

        <!-- å¯¹æ‰‹é˜µå®¹é®ç½© -->
        <view class="opponent-mask" wx:if="{{isOpponentTeam}}">
          <view class="mask-content">
            <view class="lock-icon">â›”</view>
            <text class="mask-title">ç»å¯†å†›æƒ…</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å¤‡æ³¨ - åªåœ¨æœªæŠ¥åä¸”æœªè¯·å‡æ—¶æ˜¾ç¤º -->
    <view class="remark-section" wx:if="{{!isRegistered && !isOnLeave}}">
      <view class="remark-header">
        <text class="remark-title">å¤‡æ³¨è¯´æ˜</text>
        <text class="optional-tag">é€‰å¡«ï¼ˆè¯·å‡æ—¶å¿…å¡«ï¼‰</text>
      </view>

      <textarea
        class="remark-input"
        placeholder="æŠ¥åå¤‡æ³¨æˆ–è¯·å‡åŸå› ï¼ˆä¾‹å¦‚ï¼šå¯èƒ½è¿Ÿåˆ°ã€æå‰ç¦»å¼€ã€ä¸´æ—¶æœ‰äº‹ç­‰ï¼‰"
        placeholder-class="remark-placeholder"
        value="{{notes}}"
        bindinput="onRemarkInput"
        maxlength="20"
        auto-height
      />
    </view>

    <!-- æ¯”èµ›è¯´æ˜ -->
    <view class="notice-section" wx:if="{{matchInfo.description}}">
      <view class="notice-header">
        <view class="notice-icon">ğŸ“¢</view>
        <text class="notice-title">æ¯”èµ›é¡»çŸ¥</text>
      </view>
      <view class="notice-content">
        <text class="notice-text">{{matchInfo.description}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-space"></view>
  </scroll-view>

  <!-- åº•éƒ¨æŒ‰é’® - æ ¹æ®æŠ¥åçŠ¶æ€æ˜¾ç¤º -->
  <view class="action-bar">
    <!-- åˆ†äº«æŒ‰é’® -->
    <button class="action-btn share-btn" open-type="share">
      <text class="btn-text">åˆ†äº«</text>
      <text class="btn-icon">ğŸ“¤</text>
    </button>

    <!-- æœªæŠ¥åä¸”æœªè¯·å‡ï¼šæ˜¾ç¤ºæŠ¥åå’Œè¯·å‡æŒ‰é’® -->
    <block wx:if="{{!isRegistered && !isOnLeave}}">
      <view class="action-btn submit-btn-new" catchtap="onSubmit">
        <view class="btn-glow"></view>
        <text class="btn-text">ç«‹å³æŠ¥å</text>
        <text class="btn-icon">âš¡</text>
      </view>
      <view class="action-btn leave-btn" catchtap="onRequestLeave">
        <text class="btn-text">è¯·å‡</text>
        <text class="btn-icon">ğŸ“</text>
      </view>
    </block>

    <!-- å·²æŠ¥åä½†æœªè¯·å‡ï¼šåªæ˜¾ç¤ºå–æ¶ˆæŠ¥åæŒ‰é’® -->
    <view wx:elif="{{isRegistered && !isOnLeave}}" class="action-btn cancel-registered-btn" catchtap="onCancel">
      <text class="btn-text">å–æ¶ˆæŠ¥å</text>
    </view>

    <!-- å·²è¯·å‡ï¼šæ˜¾ç¤ºå–æ¶ˆè¯·å‡æŒ‰é’® -->
    <view wx:elif="{{isOnLeave}}" class="action-btn cancel-leave-btn" catchtap="onCancelLeave">
      <text class="btn-text">å–æ¶ˆè¯·å‡</text>
      <text class="btn-icon">âœ…</text>
    </view>
  </view>

  <!-- é˜Ÿä¼é€‰æ‹©å¼¹çª—ï¼ˆä»…æ— é˜Ÿä¼çƒå‘˜æ˜¾ç¤ºï¼‰ -->
  <view class="team-selector-mask" wx:if="{{showTeamSelector}}" catchtap="onCancelTeamSelect">
    <view class="team-selector-modal" catchtap="stopPropagation">
      <view class="selector-header">
        <text class="selector-title">é€‰æ‹©æ”¯æ´é˜Ÿä¼</text>
        <text class="selector-subtitle">è¯·é€‰æ‹©ä½ è¦æ”¯æ´çš„é˜Ÿä¼å‚åŠ æ¯”èµ›</text>
      </view>

      <view class="team-options">
        <!-- é˜Ÿä¼1 -->
        <view
          class="team-option"
          bindtap="onSelectTeam"
          data-team-id="{{matchInfo.team1.id}}"
          data-team-name="{{matchInfo.team1.name}}">
          <view class="team-option-content">
            <image class="team-option-logo" src="{{matchInfo.team1.logo}}" mode="aspectFit"></image>
            <view class="team-option-info">
              <text class="team-option-name">{{matchInfo.team1.name}}</text>
              <text class="team-option-count">å·²æŠ¥å {{matchInfo.team1RegisteredCount}} äºº</text>
            </view>
          </view>
          <view class="team-option-arrow">â†’</view>
        </view>

        <!-- é˜Ÿä¼2 -->
        <view
          class="team-option"
          bindtap="onSelectTeam"
          data-team-id="{{matchInfo.team2.id}}"
          data-team-name="{{matchInfo.team2.name}}">
          <view class="team-option-content">
            <image class="team-option-logo" src="{{matchInfo.team2.logo}}" mode="aspectFit"></image>
            <view class="team-option-info">
              <text class="team-option-name">{{matchInfo.team2.name}}</text>
              <text class="team-option-count">å·²æŠ¥å {{matchInfo.team2RegisteredCount}} äºº</text>
            </view>
          </view>
          <view class="team-option-arrow">â†’</view>
        </view>
      </view>

      <view class="selector-footer">
        <view class="cancel-btn" bindtap="onCancelTeamSelect">
          <text>å–æ¶ˆ</text>
        </view>
      </view>
    </view>
  </view>
</view>
