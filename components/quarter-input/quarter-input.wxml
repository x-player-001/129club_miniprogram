<!-- WXS è¾…åŠ©å‡½æ•° -->
<wxs module="utils">
  var getEventTypeName = function(eventType) {
    var typeMap = {
      'goal': 'âš½ è¿›çƒ',
      'save': 'ğŸ§¤ æ‰‘æ•‘',
      'yellow_card': 'ğŸŸ¨ é»„ç‰Œ',
      'red_card': 'ğŸŸ¥ çº¢ç‰Œ',
      'substitution': 'ğŸ”„ æ¢äºº'
    };
    return typeMap[eventType] || eventType;
  };

  module.exports = {
    getEventTypeName: getEventTypeName
  };
</wxs>

<!-- å•èŠ‚å½•å…¥ç»„ä»¶ -->
<view class="quarter-input">
  <!-- èŠ‚æ¬¡æ ‡é¢˜ -->
  <view class="quarter-header">
    <text class="quarter-title">ç¬¬ {{quarterNumber}} èŠ‚</text>
    <text class="quarter-points-rule">{{quarterNumber <= 2 ? 'èƒœè€…å¾—1åˆ†' : 'èƒœè€…å¾—2åˆ†'}}</text>
  </view>

  <!-- è¿›çƒæ•°è¾“å…¥ -->
  <view class="goals-section">
    <view class="team-goal-input">
      <image class="team-logo-small" src="{{team1.logo}}" mode="aspectFill"></image>
      <text class="team-name-small">{{team1.name}}</text>
      <input
        class="goal-input"
        type="number"
        value="{{form.team1Goals}}"
        bindinput="onTeam1GoalsInput"
        placeholder="0"
      />
      <text class="goal-unit">çƒ</text>
    </view>

    <text class="vs-separator">-</text>

    <view class="team-goal-input">
      <input
        class="goal-input"
        type="number"
        value="{{form.team2Goals}}"
        bindinput="onTeam2GoalsInput"
        placeholder="0"
      />
      <text class="goal-unit">çƒ</text>
      <text class="team-name-small">{{team2.name}}</text>
      <image class="team-logo-small" src="{{team2.logo}}" mode="aspectFill"></image>
    </view>
  </view>

  <!-- äº‹ä»¶å½•å…¥ -->
  <view class="events-section">
    <!-- äº‹ä»¶åˆ—è¡¨ - ä½¿ç”¨æ—¶é—´è½´ç»„ä»¶ -->
    <event-timeline
      events="{{form.events}}"
      team1="{{team1}}"
      team2="{{team2}}"
      show-actions="{{true}}"
      bind:edit="onEditEvent"
      bind:delete="onDeleteEvent"
    />

    <view class="section-header-mini">
      <text class="section-title-mini">æ¯”èµ›äº‹ä»¶</text>
      <text class="event-count-mini">{{form.events.length}}æ¡</text>
    </view>

    <!-- æ·»åŠ äº‹ä»¶æŒ‰é’® -->
    <view class="event-actions-mini">
      <view
        class="event-action-mini"
        wx:for="{{eventTypes}}"
        wx:key="id"
        bindtap="onAddEvent"
        data-type="{{item.id}}"
        style="background: {{item.color}};"
      >
        <text class="action-icon-mini">{{item.icon}}</text>
        <text class="action-name-mini">{{item.name}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-events-mini" wx:if="{{form.events.length === 0}}">
      <text class="empty-text-mini">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ äº‹ä»¶</text>
    </view>
  </view>

  <!-- èŠ‚æ¬¡æ€»ç»“ -->
  <view class="summary-section">
    <view class="section-header-mini">
      <text class="section-title-mini">æœ¬èŠ‚æ€»ç»“</text>
    </view>
    <textarea
      class="summary-textarea"
      placeholder="è¾“å…¥æœ¬èŠ‚æ¯”èµ›æƒ…å†µæè¿°ï¼ˆé€‰å¡«ï¼‰"
      value="{{form.summary}}"
      bindinput="onSummaryInput"
      maxlength="500"
      auto-height
    />
  </view>
</view>

<!-- äº‹ä»¶ç¼–è¾‘å¼¹çª— -->
<view class="event-dialog" wx:if="{{showEventDialog}}">
  <view class="dialog-mask" bindtap="onCancelEvent"></view>
  <view class="dialog-content">
    <view class="dialog-header">
      <text class="dialog-title">{{editingEvent ? 'ç¼–è¾‘' : 'æ·»åŠ '}}{{currentEventType.name}}</text>
      <view class="dialog-close" bindtap="onCancelEvent">Ã—</view>
    </view>

    <view class="dialog-body">
      <!-- æ—¶é—´è¾“å…¥ -->
      <view class="form-row">
        <text class="form-label">æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</text>
        <input
          class="form-input"
          type="number"
          placeholder="è¯·è¾“å…¥æ—¶é—´"
          value="{{eventForm.minute}}"
          bindinput="onEventMinuteInput"
        />
      </view>

      <!-- é˜Ÿä¼é€‰æ‹© -->
      <view class="form-row">
        <text class="form-label">é˜Ÿä¼</text>
        <view class="team-select">
          <view
            class="team-option {{eventForm.teamId === team1.id ? 'selected' : ''}}"
            bindtap="onSelectTeam"
            data-team-id="{{team1.id}}"
          >
            {{team1.name}}
          </view>
          <view
            class="team-option {{eventForm.teamId === team2.id ? 'selected' : ''}}"
            bindtap="onSelectTeam"
            data-team-id="{{team2.id}}"
          >
            {{team2.name}}
          </view>
        </view>
      </view>

      <!-- è¿›çƒäº‹ä»¶ -->
      <block wx:if="{{eventForm.type === 'goal'}}">
        <view class="form-row">
          <text class="form-label">{{eventForm.isOwnGoal ? 'ä¹Œé¾™çƒå‘˜' : 'è¿›çƒçƒå‘˜'}}</text>
          <view class="form-row-inline">
            <view class="picker-input flex-grow" bindtap="onShowPlayerPicker">
              {{eventForm.playerName || 'è¯·é€‰æ‹©çƒå‘˜'}}
            </view>
            <view class="own-goal-switch-wrapper">
              <text class="switch-label">ä¹Œé¾™</text>
              <view
                class="own-goal-switch {{eventForm.isOwnGoal ? 'checked' : ''}}"
                bindtap="onToggleOwnGoal"
              >
                <view class="switch-handle"></view>
              </view>
            </view>
          </view>
        </view>

        <view class="form-row">
          <text class="form-label">åŠ©æ”»çƒå‘˜ï¼ˆé€‰å¡«ï¼‰</text>
          <view class="picker-input" bindtap="onShowAssistPicker">
            {{eventForm.assistName || 'è¯·é€‰æ‹©çƒå‘˜'}}
          </view>
        </view>
      </block>

      <!-- æ‰‘æ•‘ã€é»„ç‰Œã€çº¢ç‰Œäº‹ä»¶ -->
      <block wx:if="{{eventForm.type === 'save' || eventForm.type === 'yellow_card' || eventForm.type === 'red_card'}}">
        <view class="form-row">
          <text class="form-label">çƒå‘˜</text>
          <view class="picker-input" bindtap="onShowPlayerPicker">
            {{eventForm.playerName || 'è¯·é€‰æ‹©çƒå‘˜'}}
          </view>
        </view>
      </block>

      <!-- æ¢äººäº‹ä»¶ -->
      <block wx:if="{{eventForm.type === 'substitution'}}">
        <view class="form-row">
          <text class="form-label">ä¸‹åœºçƒå‘˜</text>
          <view class="picker-input" bindtap="onShowPlayerOutPicker">
            {{eventForm.playerOutName || 'è¯·é€‰æ‹©çƒå‘˜'}}
          </view>
        </view>
        <view class="form-row">
          <text class="form-label">ä¸Šåœºçƒå‘˜</text>
          <view class="picker-input" bindtap="onShowPlayerInPicker">
            {{eventForm.playerInName || 'è¯·é€‰æ‹©çƒå‘˜'}}
          </view>
        </view>
      </block>

      <!-- å¤‡æ³¨ -->
      <view class="form-row">
        <text class="form-label">å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</text>
        <input
          class="form-input"
          placeholder="å¦‚ï¼šè¿œå°„ã€ç‚¹çƒç­‰"
          value="{{eventForm.notes}}"
          bindinput="onEventNotesInput"
        />
      </view>
    </view>

    <view class="dialog-footer">
      <button class="dialog-btn cancel-btn" bindtap="onCancelEvent">å–æ¶ˆ</button>
      <button class="dialog-btn confirm-btn" bindtap="onSaveEvent">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- çƒå‘˜é€‰æ‹©å™¨ - è¿›çƒçƒå‘˜ -->
<select-grid
  show="{{showPlayerPicker}}"
  title="{{eventForm.isOwnGoal ? 'é€‰æ‹©ä¹Œé¾™çƒå‘˜' : 'é€‰æ‹©è¿›çƒçƒå‘˜'}}"
  options="{{filteredPlayers}}"
  value-field="id"
  display-field="name"
  avatar-field="avatar"
  show-avatar="{{true}}"
  multiple="{{false}}"
  bind:confirm="onConfirmPlayerSelect"
  bind:close="onClosePlayerPicker"
/>

<!-- çƒå‘˜é€‰æ‹©å™¨ - åŠ©æ”»çƒå‘˜ -->
<select-grid
  show="{{showAssistPicker}}"
  title="é€‰æ‹©åŠ©æ”»çƒå‘˜"
  options="{{filteredPlayers}}"
  value-field="id"
  display-field="name"
  avatar-field="avatar"
  show-avatar="{{true}}"
  multiple="{{false}}"
  bind:confirm="onConfirmPlayerSelect"
  bind:close="onClosePlayerPicker"
/>

<!-- çƒå‘˜é€‰æ‹©å™¨ - ä¸‹åœºçƒå‘˜ -->
<select-grid
  show="{{showPlayerOutPicker}}"
  title="é€‰æ‹©ä¸‹åœºçƒå‘˜"
  options="{{filteredPlayers}}"
  value-field="id"
  display-field="name"
  avatar-field="avatar"
  show-avatar="{{true}}"
  multiple="{{false}}"
  bind:confirm="onConfirmPlayerSelect"
  bind:close="onClosePlayerPicker"
/>

<!-- çƒå‘˜é€‰æ‹©å™¨ - ä¸Šåœºçƒå‘˜ -->
<select-grid
  show="{{showPlayerInPicker}}"
  title="é€‰æ‹©ä¸Šåœºçƒå‘˜"
  options="{{filteredPlayers}}"
  value-field="id"
  display-field="name"
  avatar-field="avatar"
  show-avatar="{{true}}"
  multiple="{{false}}"
  bind:confirm="onConfirmPlayerSelect"
  bind:close="onClosePlayerPicker"
/>
